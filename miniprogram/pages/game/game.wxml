<component-auth bindAuthReady="onAuthReady">
  <view class="game" wx:if="{{ game }}">
    <view class="title {{ isShowingHiddenCard ? 'flipped' : '' }}" catchtap="onCardTap">
      <view class="card back">
        <view class="textWrapper">
          <text class="h2" wx:if="{{ isShowingHiddenCard && openid && roleInfo[openid] === 0 }}">å¤šæ•°æ´¾è¯è¯­ï¼šã€Œ{{ game.majorityWord }}ã€</text>
          <text class="h2" wx:if="{{ isShowingHiddenCard && openid && roleInfo[openid] === 0 }}">å°‘æ•°æ´¾è¯è¯­ï¼šã€Œ{{ game.minorityWord }}ã€</text>
          <text class="h1" wx:if="{{ isShowingHiddenCard && openid && roleInfo[openid] === 1 }}">ä½ çš„è¯æ˜¯ï¼šã€Œ{{ game.majorityWord }}ã€</text>
          <text class="h1" wx:if="{{ isShowingHiddenCard && openid && roleInfo[openid] === 2 }}">ä½ çš„è¯æ˜¯ï¼šã€Œ{{ game.minorityWord }}ã€</text>
          <text class="h1" wx:if="{{ isShowingHiddenCard && openid && roleInfo[openid] === 3 }}">ä½ çš„è¯æ˜¯ï¼šã€Œ{{ game.minorityWord.length }}ä¸ªå­—ã€</text>
          <text class="h3" wx:if="{{ isShowingHiddenCard &&openid && game.status === 1 }}">ç‚¹å‡»éšè—</text>
        </view>
      </view>
      <view class="card">
        <view class="textWrapper">
          <text class="h2" wx:if="{{ game.status === 0 }}">{{ game.shortcut}} æˆ¿é—´çŠ¶æ€ï¼šå‡†å¤‡ä¸­</text>
          <text class="h2" wx:if="{{ game.status === 1 && game.currentVote === undefined}}">{{ game.shortcut}} æˆ¿é—´çŠ¶æ€ï¼šè¿›è¡Œä¸­</text>
          <text class="h2" wx:if="{{ game.status === 1 && game.currentVote !== undefined}}">{{ game.shortcut}} æˆ¿é—´çŠ¶æ€ï¼šæŠ•ç¥¨ä¸­</text>
          <text class="h2" wx:if="{{ game.status === 2 }}">{{ game.shortcut}} æˆ¿é—´çŠ¶æ€ï¼šå·²ç»“æŸ</text>
          <text class="h1" wx:if="{{ game.status === 2 && game.winnerDetails === 0 }}">äººè·èƒœ-åªæœ‰äººçŒœå‡º</text>
          <text class="h1" wx:if="{{ game.status === 2 && game.winnerDetails === 1 }}">äººèººèµ¢-é¬¼è·³é¬¼å¤±è´¥</text>
          <text class="h1" wx:if="{{ game.status === 2 && game.winnerDetails === 2 }}">é¬¼è·èƒœ-åŒæ–¹éƒ½çŒœå‡º</text>
          <text class="h1" wx:if="{{ game.status === 2 && game.winnerDetails === 3 }}">é¬¼èººèµ¢-åŒæ–¹æœªçŒœå‡º</text>
          <text class="h1" wx:if="{{ game.status === 2 && game.winnerDetails === 4 }}">é¬¼å¤§èƒœ-åªæœ‰é¬¼çŒœå‡º</text>
          <text class="h1" wx:if="{{ game.status === 2 && game.winnerDetails === 5 }}">é¬¼å¤§èƒœ-å‰©é¬¼è¿‡åŠæ•°</text>
          <text class="h1" wx:if="{{ game.status === 2 && game.winnerDetails === undefined && game.winner === 0 }}">äººè·èƒœ</text>
          <text class="h1" wx:if="{{ game.status === 2 && game.winnerDetails === undefined && game.winner === 1 }}">é¬¼è·èƒœ</text>
          <text class="h3" wx:if="{{ game.status === 1 }}">ç‚¹å‡»æŸ¥çœ‹éšè—å†…å®¹</text>
          <text class="h3" wx:if="{{ game.status !== 0 }}">å¤šæ•°æ´¾-å°‘æ•°æ´¾-é¬¼ï¼š{{ game.majority }}-{{ game.minority }}-{{ game.ghost }}</text>
        </view>
      </view>
    </view>
    <scroll-view class="list" scroll-y="true">
      <view class="itemWrapper" wx:key="*this" wx:if="{{ userInfo[item] }}" wx:for="{{ players }}">
        <view class="item {{ game && game.status === 1 && game.currentVote[item] !== undefined ? 'voted' : '' }}">
          <view class="avatar"  catchtap="onAvatarTap" data-openid="{{ item }}">
            {{ avatarInfo[item] }}
          </view>
          <view class="info" wx:if="{{ game.status === 0 }}" catchtap="onUserTap" data-openid="{{ item }}">
            <text class="nickname">{{ userInfo[item].nickName }}</text>
          </view>

          <view class="info" wx:if="{{ game.status === 1 }}" catchtap="onUserTap" data-openid="{{ item }}">
            <text class="nickname">{{ userInfo[item].nickName }}</text>
            <text class="note" wx:if="{{ noteInfo[item] && targetOpenid !== item }}">â€œ{{ noteInfo[item] }}â€</text>
            <input class="note" wx:if="{{ targetOpenid === item }}"
              focus="{{ targetOpenid === item }}"
              value="{{ noteInfo[item] }}"
              bindblur="onInputBlur">
            </input>
          </view>

          <view class="info" wx:if="{{ game.status === 2 }}" catchtap="onUserTap" data-openid="{{ item }}">
            <text class="nickname">{{ userInfo[item].nickName }}</text>
            <text class="note" wx:if="{{ roleInfo[item] === 1 }}">ã€Œ{{ game.majorityWord }}ã€</text>
            <text class="note" wx:if="{{ roleInfo[item] === 2 }}">ã€Œ{{ game.minorityWord }}ã€</text>
            <text class="note" wx:if="{{ roleInfo[item] === 3 }}">é¬¼</text>
          </view>

          <view wx:if="{{ roleInfo[openid] === 0 || roleInfo[item] === 0 || game.status === 2 }}" class="detail">
            <view class="c0" wx:if="{{ roleInfo[item] === 0 }}">è£åˆ¤</view>
            <view class="c1" wx:if="{{ roleInfo[item] === 1 }}">å¤šæ•°æ´¾</view>
            <view class="c2" wx:if="{{ roleInfo[item] === 2 }}">å°‘æ•°æ´¾</view>
            <view class="c3" wx:if="{{ roleInfo[item] === 3 }}">é¬¼</view>
          </view>
          <view wx:elif="{{ game.status === 1 && markInfo[item] }}" class="detail">
            <view class="c1" wx:if="{{ markInfo[item] === 1 }}">å¤šæ•°æ´¾?</view>
            <view class="c2" wx:if="{{ markInfo[item] === 2 }}">å°‘æ•°æ´¾?</view>
            <view class="c3" wx:if="{{ markInfo[item] === 3 }}">é¬¼?</view>
          </view>

          <view class="review">
            {{  (thumbUp[item] ? 'ğŸ‘' + thumbUp[item] : '') + ' '  + (thumbDown[item] ? 'ğŸ‘' + thumbDown[item] : '') }}
          </view>
        </view>
      </view>
    </scroll-view>
    <view class="actionCard {{ isReviewingVote ? 'presenting' : '' }}">
      <scroll-view class="voteList" scroll-y="true">
        <view class="voteContainer" wx:key="*this" wx:for-item="vote" wx:for="{{ game.votes }}">
          <text class="voteTitle">ç¬¬{{ game.votes.length - index }}è½®æŠ•ç¥¨ç»“æœ</text>
          <view class="voteRecord"  wx:key="*this" wx:for-item="record" wx:for="{{ vote }}">
            <view class="voteAvatar">
              {{ avatarInfo[record.targetId] }}
            </view>
            <view class="voteContent">
              <view class="voteTargetContainer">
                <text>{{ userInfo[record.targetId].nickName }}</text>è·å¾—äº†<text>{{ record.count }}ç¥¨</text>
              </view>
              <view class="voteSourceContainer">
                <view class="voteAvatarSource"  wx:key="*this" wx:for-item="source" wx:for="{{ record.source }}">
                  {{ avatarInfo[source] }}
                </view>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
  <view class="buttonWrapper" wx:if="{{ game && roleInfo[openid] === 0 }}">
    <button wx:if="{{ game.status === 0 }}" class="button" catchtap="onStartGame">å¼€å§‹æ‰é¬¼</button>
    <button wx:if="{{ game.status === 1 }}" class="button" catchtap="onHostOperation">è£åˆ¤æ“ä½œ</button>
  </view>
  <view class="buttonWrapper" wx:if="{{ game && game.status === 1 && roleInfo[openid] !== 0 }}">
    <button class="button" wx:if="{{ !isReviewingVote }}" catchtap="onReviewVote">æŸ¥çœ‹æŠ•ç¥¨ç»“æœ</button>
    <button class="button" wx:if="{{ isReviewingVote }}" catchtap="onReviewVote">éšè—æŠ•ç¥¨ç»“æœ</button>
  </view>
</component-auth>
